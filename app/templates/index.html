<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Question-based Auto Build — Pro</title>
  <style>
    body{ font-family: Arial, sans-serif; max-width:980px; margin:auto; padding:20px }
    .card{ border:1px solid #ddd; padding:14px; border-radius:8px; margin-bottom:12px }
    label{ display:block; margin-top:8px }
    .mono{ font-family: monospace; background:#f6f6f6; padding:6px; border-radius:4px; display:inline-block }
    .result pre{ white-space: pre-wrap; font-family: monospace; background:#222; color:#eee; padding:10px; border-radius:6px }
  </style>
</head>
<body>
  <h1>Question-based Auto Build — Pro</h1>

  <div class="card">
    <form action="/upload" method="post" enctype="multipart/form-data">
      <label>Upload <code>main.c</code> (single file):</label>
      <input type="file" name="source" accept=".c" required>

      <label>Standard:
        <select name="std">
          <option value="c99">C99</option>
          <option value="c11" selected>C11</option>
          <option value="gnu11">gnu11</option>
        </select>
      </label>

      <label>Optimization:
        <select name="opt">
          <option value="O0">O0 (no opt)</option>
          <option value="O1">O1</option>
          <option value="O2" selected>O2</option>
          <option value="O3">O3</option>
        </select>
      </label>

      <label><input type="checkbox" name="use_docker" checked> Run builds in Docker (recommended for safety)</label>

      <label>Targets:</label>
      <label><input type="checkbox" name="target_linux" checked> Linux (gcc)</label>
      <label><input type="checkbox" name="target_windows"> Windows (cross via mingw-w64)</label>
      <label><input type="checkbox" name="target_macos"> macOS (recommended: CI macos runner)</label>

      <div style="margin-top:10px;">
        <button type="submit">Build</button>
      </div>
    </form>
  </div>

  {% if built %}
  <div class="card result">
    <h3>Build Session: {{ session }}</h3>
    <p>Download artifacts: <a href="{{ zip_url }}">{{ zip_url.split('/')[-1] }}</a></p>
    <p>README: <a href="{{ readme_url }}">{{ readme_url.split('/')[-1] }}</a></p>

    <h4>Summary</h4>
    {% for k,v in build_results.items() %}
      <div style="border:1px solid #eee;padding:8px;border-radius:6px;margin-bottom:6px;">
        <strong>{{k}}</strong> — Success: {{ 'Yes' if v.success else 'No' }} (rc={{v.returncode}})
        <div style="margin-top:6px;">
          <details>
            <summary>Command & Logs</summary>
            <pre>cmd: {{ v.cmd }}
STDOUT:
{{ v.stdout }}

STDERR:
{{ v.stderr }}</pre>
          </details>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endif %}
</body>
</html>